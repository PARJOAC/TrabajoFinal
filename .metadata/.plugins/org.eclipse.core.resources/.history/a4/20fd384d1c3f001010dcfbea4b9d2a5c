package bd;

import java.sql.*;
import java.util.ArrayList;
import java.util.List;

public class DAOFacturas {

    public static class FacturaResumen {
        public int id;
        public String usuario;
        public double total;
        public double iva;
        public double efectivo;
        public double cambio;
        public String fecha;

        public FacturaResumen(int id, String usuario, double total, double iva, double efectivo, double cambio, String fecha) {
            this.id = id;
            this.usuario = usuario;
            this.total = total;
            this.iva = iva;
            this.efectivo = efectivo;
            this.cambio = cambio;
            this.fecha = fecha;
        }
    }

    public List<FacturaResumen> listarFacturas() throws SQLException, ClassNotFoundException {
        List<FacturaResumen> lista = new ArrayList<>();

        String sql = """
            SELECT f.idFactura, u.nombreUsuario AS usuario, f.total, f.iva, f.efectivo, f.cambio, f.fecha
            FROM facturas f
            JOIN usuarios u ON f.usuarioResponsable = u.idUsuario
            ORDER BY f.fecha DESC
        """;

        try (Connection conn = BDConnection.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql);
             ResultSet rs = stmt.executeQuery()) {

            while (rs.next()) {
                lista.add(new FacturaResumen(
                        rs.getInt("idFactura"),
                        rs.getString("usuario"),
                        rs.getDouble("total"),
                        rs.getDouble("iva"),
                        rs.getDouble("efectivo"),
                        rs.getDouble("cambio"),
                        rs.getTimestamp("fecha").toString()
                ));
            }
        }

        return lista;
    }
}
